(function(t){function e(e){for(var a,r,c=e[0],s=e[1],l=e[2],u=0,h=[];u<c.length;u++)r=c[u],Object.prototype.hasOwnProperty.call(i,r)&&i[r]&&h.push(i[r][0]),i[r]=0;for(a in s)Object.prototype.hasOwnProperty.call(s,a)&&(t[a]=s[a]);d&&d(e);while(h.length)h.shift()();return o.push.apply(o,l||[]),n()}function n(){for(var t,e=0;e<o.length;e++){for(var n=o[e],a=!0,c=1;c<n.length;c++){var s=n[c];0!==i[s]&&(a=!1)}a&&(o.splice(e--,1),t=r(r.s=n[0]))}return t}var a={},i={app:0},o=[];function r(e){if(a[e])return a[e].exports;var n=a[e]={i:e,l:!1,exports:{}};return t[e].call(n.exports,n,n.exports,r),n.l=!0,n.exports}r.m=t,r.c=a,r.d=function(t,e,n){r.o(t,e)||Object.defineProperty(t,e,{enumerable:!0,get:n})},r.r=function(t){"undefined"!==typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(t,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(t,"__esModule",{value:!0})},r.t=function(t,e){if(1&e&&(t=r(t)),8&e)return t;if(4&e&&"object"===typeof t&&t&&t.__esModule)return t;var n=Object.create(null);if(r.r(n),Object.defineProperty(n,"default",{enumerable:!0,value:t}),2&e&&"string"!=typeof t)for(var a in t)r.d(n,a,function(e){return t[e]}.bind(null,a));return n},r.n=function(t){var e=t&&t.__esModule?function(){return t["default"]}:function(){return t};return r.d(e,"a",e),e},r.o=function(t,e){return Object.prototype.hasOwnProperty.call(t,e)},r.p="";var c=window["webpackJsonp"]=window["webpackJsonp"]||[],s=c.push.bind(c);c.push=e,c=c.slice();for(var l=0;l<c.length;l++)e(c[l]);var d=s;o.push([0,"chunk-vendors"]),n()})({0:function(t,e,n){t.exports=n("56d7")},"12ae":function(t,e,n){"use strict";n("8694")},"56d7":function(t,e,n){"use strict";n.r(e);n("e260"),n("e6cf"),n("cca6"),n("a79d");var a=n("2b0e"),i=function(){var t=this,e=t.$createElement,n=t._self._c||e;return n("div",{attrs:{id:"app"}},[n("router-view")],1)},o=[],r={name:"App"},c=r,s=n("2877"),l=Object(s["a"])(c,i,o,!1,null,null,null),d=l.exports,u=n("8c4f"),h=function(){var t=this,e=t.$createElement,n=t._self._c||e;return n("div",{staticClass:"container"},[n("div",{staticClass:"plat-top-contain"},[n("Button",{attrs:{type:"primary"},on:{click:t.compile}},[t._v("编译")])],1),n("plat-left-tool"),n("plat-main-draw",{ref:"drawPlat"})],1)},f=[],p=function(){var t=this,e=t.$createElement;t._self._c;return t._m(0)},m=[function(){var t=this,e=t.$createElement,n=t._self._c||e;return n("div",{staticClass:"plat-left-contain"},[n("div",{},[n("h3",{staticStyle:{"margin-bottom":"5px"}},[t._v("模型: ")]),n("div",{staticClass:"rect-div",attrs:{draggable:"true"}})])])}],v={name:"PlatLeftTool",components:{},directives:{drag:{bind:function(t){console.log("---",this);var e=t;e.onmousedown=function(t){var n=t.clientX-e.offsetLeft,a=t.clientY-e.offsetTop;document.onmousemove=function(t){var i=t.clientX-n,o=t.clientY-a;e.style.left=i+"px",e.style.top=o+"px"},document.onmouseup=function(){document.onmousemove=null,document.onmouseup=null}}}}},methods:{drag:function(t){t.dataTransfer.setData("Text",1)}}},g=v,b=(n("b718"),Object(s["a"])(g,p,m,!1,null,"a21c3eec",null)),x=b.exports,w=function(){var t=this,e=t.$createElement,n=t._self._c||e;return n("div",{staticClass:"plat-main-contain"},[n("div",{staticStyle:{position:"relative",width:"100%",height:"100%"},attrs:{id:"idsw-bpmn"},on:{drop:t.addNode,dragover:function(e){return e.preventDefault(),t.allowDrop(e)}}},[n("svg",{attrs:{width:"100%",height:"100%",id:"plat"}},[n("defs",[n("marker",{attrs:{id:"arrowhead",viewBox:"0 0 10 10",refX:"10",refY:"5",markerWidth:"6",markerHeight:"6",orient:"auto"}},[n("path",{attrs:{d:"M 0 0 L 10 5 L 0 10 z","stroke-width":"0",stroke:"#333"}})])])])]),n("div",{directives:[{name:"show",rawName:"v-show",value:t.isShowInfoBox,expression:"isShowInfoBox"}],staticClass:"info-box"},[n("Form",{attrs:{"label-position":"right","label-width":80}},[n("FormItem",{attrs:{label:"任务名"}},[n("Input",{staticStyle:{width:"150px"},attrs:{clearable:""},model:{value:t.nodeData.name,callback:function(e){t.$set(t.nodeData,"name",e)},expression:"nodeData.name"}})],1),n("FormItem",{attrs:{label:"任务类型"}},[n("Input",{staticStyle:{width:"150px"},attrs:{clearable:""},model:{value:t.nodeData.type,callback:function(e){t.$set(t.nodeData,"type",e)},expression:"nodeData.type"}})],1),n("FormItem",{attrs:{label:"任务路径"}},[n("Input",{staticStyle:{width:"150px"},attrs:{clearable:""},model:{value:t.nodeData.path,callback:function(e){t.$set(t.nodeData,"path",e)},expression:"nodeData.path"}})],1),n("FormItem",[n("Button",{attrs:{type:"primary"},on:{click:t.saveInfo}},[t._v("保存")]),n("Button",{staticStyle:{"margin-left":"12px"},attrs:{type:"error",ghost:""},on:{click:t.delNode}},[t._v("删除")])],1)],1)],1)])},y=[],N=(n("99af"),n("7db0"),n("c740"),n("4160"),n("caad"),n("c975"),n("baa5"),n("d81d"),n("fb6a"),n("a434"),n("b0c0"),n("d3b7"),n("ac1f"),n("25f0"),n("2532"),n("466d"),n("1276"),n("159b"),n("3835")),k=n("5698"),D=n("e069"),I={name:"PlatMainDraw",components:{Form:D["Form"],FormItem:D["FormItem"],Button:D["Button"],Input:D["Input"]},data:function(){return{isShowInfoBox:!1,drawLine:!1,lineToNode:null,linePoints:[],lineParentId:"",lineTranslate:[],activeLine:null,rectWidth:100,rectHeight:50,chooseNode:null,gText:"",gType:"",gPath:"",nodeData:{id:"",name:"",type:"",path:"",dependOn:[]},nodeList:[]}},methods:{getHandeledData:function(){console.log(this.nodeList)},allowDrop:function(t){t.preventDefault()},drop:function(t){t.preventDefault()},handelData:function(){var t=this;return{getNode:function(e){return t.nodeList.find((function(t){return t.id==e}))},findNodeIndex:function(e){var n=-1;return t.nodeList.find((function(t,a){return t.id===e&&(n=a),t.id==e})),n},addNode:function(e){t.nodeList.push(Object.assign({},e))},delNode:function(e){var n=this.findNodeIndex(e);-1!==n&&(t.nodeList.forEach((function(t){t.dependOn.includes(e)&&t.dependOn.splice(t.dependOn.indexOf(e),1)})),t.nodeList.splice(n,1))},updateNode:function(e,n){var a=this.findNodeIndex(e);-1!==a&&t.nodeList.splice(a,1,n)},addDependenceInfo:function(t,e){var n=this.getNode(t);n.dependOn.push(e),this.updateNode(t,n)},delDependenceInfo:function(t,e){var n=this.getNode(t),a=n.dependOn.findIndex((function(t){return t===e}));-1!==a&&(n.dependOn.splice(a,1),this.updateNode(t,n))}}},saveInfo:function(){var t=k["c"](this.chooseNode).attr("id");this.handelData().updateNode(t,this.nodeData),k["c"](this.chooseNode).select("text").text(this.nodeData.name);var e=this.getRectWidth(this.nodeData.name),n=k["c"](this.chooseNode).select("rect").attr("x"),a=k["c"](this.chooseNode).select("rect").attr("width");k["c"](this.chooseNode).select("rect").attr("width",e).attr("x",n-(e-a)/2)},delNode:function(){var t=k["c"](this.chooseNode).attr("id");this.handelData().delNode(t),k["d"]('path[from="'+t+'"]').remove(),k["d"]('path[to="'+t+'"]').remove(),k["c"](this.chooseNode).remove(),this.chooseNode=null,this.isShowInfoBox=!1},addNode:function(t){var e={id:"",name:"",type:"",path:"",dependOn:[]};e.id=(new Date).getTime().toString(),this.handelData().addNode(e);var n=k["c"]("#plat"),a=t.offsetX,i=t.offsetY,o=this,r=n.append("g").attr("id",e.id).attr("transform","translate(0, 0)");r.append("rect").attr("width",this.rectWidth).attr("height",this.rectHeight).attr("x",a-this.rectWidth/2).attr("y",i-this.rectHeight/2).attr("rx",this.rectHeight/2).attr("ry",this.rectHeight/2).attr("stroke-width",1).attr("stroke","#333").attr("fill","#fff"),r.append("circle").attr("class","top-circle").attr("cx",a).attr("cy",i-this.rectHeight/2).attr("r",5),r.append("circle").attr("class","bottom-circle").attr("cx",a).attr("cy",i+this.rectHeight/2).attr("r",5),r.append("text").text("").attr("x",a).attr("y",i).attr("dominant-baseline","central").attr("text-anchor","middle"),n.selectAll("g").call(k["a"]().subject((function(){var t=k["c"](this).attr("transform"),e=o.getTranslate(t);return{x:e[0],y:e[1]}})).on("drag",(function(){var t="translate(".concat(k["b"].x,", ").concat(k["b"].y,")");k["c"](this).attr("transform",t),o.updateCable(this)})).on("end",(function(){}))).on("click",(function(){k["b"].stopPropagation(),o.clickNode(this)})),n.on("click",(function(){o.isShowInfoBox=!1,k["d"](".click-group").classed("click-group",!1)})),r.selectAll("circle").call(k["a"]().on("start",(function(){o.lineStarted(this)})).on("drag",this.lineDragged).on("end",this.lineEnded)).on("mouseover",(function(){o.lineToMouseover(this)})).on("mouseout",(function(){o.circleMouseout(this)}))},clickNode:function(t){var e=k["c"](t).attr("id");this.nodeData=this.handelData().getNode(e),this.isShowInfoBox=!0,this.chooseNode=t,k["d"](".click-group").classed("click-group",!1);var n=this.getGroupNodes(t);for(var a in n)n[a].classed("click-group",!0)},lineStarted:function(t){this.drawLine=!1,this.lineParentId="";var e=k["c"](t),n=k["c"](t.parentNode);this.lineParentId=n.attr("id");var a=+e.attr("cx"),i=+e.attr("cy")+4,o=n.attr("transform");this.lineTranslate=this.getTranslate(o),this.linePoints.push([a+this.lineTranslate[0],i+this.lineTranslate[1]]),this.linePoints.push([a,i]),this.activeLine=k["c"]("svg").append("path").attr("class","line-to").attr("from",n.attr("id")).attr("start",a+", "+i).attr("marker-end","url(#arrowhead)")},lineDragged:function(){this.drawLine=!0,this.linePoints[1]=[k["b"].x+this.lineTranslate[0],k["b"].y+this.lineTranslate[1]];var t=this.linePoints;this.activeLine.attr("d",(function(){return"M"+t[0][0]+","+t[0][1]+"C"+t[0][0]+","+(t[0][1]+t[1][1])/2+" "+t[1][0]+","+(t[0][1]+t[1][1])/2+" "+t[1][0]+","+t[1][1]}))},lineEnded:function(){this.drawLine=!1;var t=k["d"]("circle.end");if(t.empty())this.activeLine.remove();else{var e=k["c"](t.node().parentNode),n=e.attr("id");this.handelData().addDependenceInfo(n,this.lineParentId),t.classed("end",!1),this.activeLine.attr("to",n);var a=Object(N["a"])(this.linePoints[1],2),i=a[0],o=a[1],r=t.attr("class").slice(0,t.attr("class").indexOf("-circle"))+"Circle";this.activeLine.attr("end",i+", "+o).attr("site",r);var c=this;k["c"]("svg").selectAll(".line-to").on("mouseover",(function(){k["c"](this).classed("line-light",!0)})).on("mouseout",(function(){k["c"](this).classed("line-light",!1)})).on("click",(function(){c.clickLine(this)}))}this.lineToNode=null,this.activeLine=null,this.linePoints=[],this.lineTranslate=null},lineToMouseover:function(t){k["c"](t).classed("mouseLight",!0);var e=this.lineParentId,n=k["c"](t.parentNode).attr("id"),a=e===n,i=!1;this.lineParentId&&k["d"]("path.line-to").each((function(){var t=k["c"](this).attr("from"),a=k["c"](this).attr("to");t===e&&a===n&&(i=!0)})),!this.drawLine||a||i||(this.lineToNode=k["c"](t.parentNode),k["d"]("circle.end").classed("end",!1),k["c"](t).classed("end",!0))},circleMouseout:function(t){k["c"](t).classed("mouseLight",!1)},clickLine:function(t){k["b"].stopPropagation(),k["c"](t).classed("click-group",!0)},keyUp:function(t){var e=0,n=t||event;if(e=n.keyCode||n.which||n.charCode,46===e&&(this.isShowInfoBox&&this.delNode(),null!==k["c"]("path.click-group")._groups[0][0])){var a=k["c"]("path.click-group").attr("to"),i=k["c"]("path.click-group").attr("from");this.handelData().delDependenceInfo(a,i),k["d"]("path.click-group").remove()}},getTranslate:function(t){var e=t.substring(t.indexOf("(")+1,t.indexOf(")")).split(",");return[+e[0],+e[1]]},updateCable:function(t){var e=k["c"](t).attr("id"),n=k["c"](t).attr("transform"),a=this.getTranslate(n),i=this;k["d"]('path[from="'+e+'"]').each((function(){i.updateEachLine(t,a,this,"from")})),k["d"]('path[to="'+e+'"]').each((function(){i.updateEachLine(t,a,this,"to")}))},updateEachLine:function(t,e,n,a){var i=k["c"](n).attr("d"),o=[],r=[];if("from"==a)o=k["c"](n).attr("start").split(",").map((function(t,n){return+t+e[n]})),r=i.substring(i.lastIndexOf(" ")+1).split(",").map((function(t){return+t}));else{o=i.substring(1,i.indexOf("C")).split(",").map((function(t){return+t}));var c=k["c"](n).attr("site");r=[+this.getGroupNodes(t)[c].attr("cx")+e[0],+this.getGroupNodes(t)[c].attr("cy")+e[1]]}k["c"](n).attr("d",(function(){return"M"+o[0]+","+o[1]+" C"+o[0]+","+(o[1]+r[1])/2+" "+r[0]+","+(o[1]+r[1])/2+" "+r[0]+","+r[1]}))},getGroupNodes:function(t){var e={};return e.rect=k["c"](t).select("rect"),e.topCircle=k["c"](t).select("circle.top-circle"),e.bottomCircle=k["c"](t).select("circle.bottom-circle"),e.text=k["c"](t).select("text"),e},getRectWidth:function(t){if(""==t)return this.rectWidth;var e=t.match(/[^\x00-\xff]/g),n=e?e.length:0,a=(t.length-n)/2+n,i=14*a+28;return i<this.rectWidth?this.rectWidth:i}},mounted:function(){document.onkeyup=this.keyUp}},L=I,O=(n("12ae"),Object(s["a"])(L,w,y,!1,null,"58514e54",null)),P=O.exports,T={name:"Platform",components:{PlatLeftTool:x,PlatMainDraw:P,Button:D["Button"]},methods:{compile:function(){this.$refs.drawPlat.getHandeledData()}}},_=T,S=Object(s["a"])(_,h,f,!1,null,null,null),j=S.exports,C=[{path:"/",redirect:"/index"},{name:"index",path:"/index",component:j}];a["default"].use(u["a"]);var B=new u["a"]({routes:C}),M=B,E=n("1f94"),H=n.n(E),$=(n("add7"),n("dcad"),n("bc3a")),F=n.n($),W=n("2106"),A=n.n(W);a["default"].config.productionTip=!1,a["default"].use(H.a),a["default"].use(A.a,F.a),new a["default"]({router:M,render:function(t){return t(d)}}).$mount("#app")},8694:function(t,e,n){},"95f4":function(t,e,n){},add7:function(t,e,n){},b718:function(t,e,n){"use strict";n("95f4")}});
//# sourceMappingURL=app.771676db.js.map